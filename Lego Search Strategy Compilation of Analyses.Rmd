---
title: "Lego Search Strategy Compilation of Analyses"
author: Mona Zhu
date: Updated July 16, 2019
output: 
  html_document:
    fig_width: 8
    fig_height: 5
    toc: true
    toc_float: true
    theme: cerulean
    highlight: tango
    code_folding: hide
---

<style>
pre code, pre, code {
  overflow-y: auto !important;
  max-height: 20em;
}
</style>

```{r, warning = F, message = F}
library(car)
library(ggplot2)
library(plyr)
library(reshape2)
library(wesanderson)
library(corrplot)
library(BayesFactor)
library(sjPlot)
library(ez)
library(lme4)
library(RColorBrewer)
library(openxlsx)
library(corrplot)
```

```{r}
# setwd("C:/Users/monaj/Dropbox/CANB Lab/Lego & Search/Online Lego Study")
df<-read.csv("Lego_Combined In-Lab&Turk&SONA_3Sept2019.csv")

df$StudyType<-factor(ifelse(df$Study=="Sona E1"|df$Study=="Sona E2", "Sona", 
                     ifelse(df$Study=="Mturk E1"|df$Study=="Mturk E2"|df$Study=="Mturk E3", "Mturk", "In Lab")))

# Pre-Task Choice
df$Choice<-factor(recode(as.character(df$Choice), "''=NA; 'Categorize then search'='Organize First'; 
                  'Search without categorizing'='Search Only'"))
df$Choice<-factor(df$Choice, levels(df$Choice)[c(2,1)])
df$Choice.Num<-ifelse(df$Choice=="Organize First", 1, 0)

# Post-Task Choice (in-lab only)
df$Future.Choice<-factor(recode(as.character(df$Future.Choice), "''=NA; 'Categorize then search'='Organize First'; 
                         'Search without categorizing'='Search Only'"))
df$Future.Choice<-factor(df$Future.Choice, levels(df$Future.Choice)[c(2,1)])
df$FutureChoice.Num<-ifelse(df$Future.Choice=="Organize First", 1, 0)

# Assigned Condition (in-lab only)
df$Condition<-factor(recode(as.character(df$Condition), "''=NA; 'Categorize then search'='Organize First';
                     'Search without categorizing'='Search Only'"))
df$Condition<-factor(df$Condition, levels(df$Condition)[c(2,1)])

# Recoding other variables
df$PreTimeDiff<-as.numeric(df$Time_SearchTotal-df$Time_OrgTotal)
df$PostTimeDiff<-as.numeric(df$PostTime_SearchTotal-df$PostTime_OrgTotal)
df$EffDiff<-as.numeric(df$Search.Eff-df$Org.Eff)
df$FunDiff<-as.numeric(df$Search.Fun-df$Org.Fun)
df$Switch.Num<-ifelse(df$Switch=="Same", 0, 1)

# time<-df[complete.cases(df$Time_Org.min), ] # data set where time estimation was measured
# eff<-df[complete.cases(df$Org.Eff), ] # dataset
# fun<-df[complete.cases(df$Org.Fun), ]
# post<-df[!is.na(df$Future.Choice),]
```

##### Code for making split violin plot
```{r}
### Split Violin Function

GeomSplitViolin <- ggproto("GeomSplitViolin", GeomViolin, draw_group = function(self, data, ..., draw_quantiles = NULL){
  data <- transform(data, xminv = x - violinwidth * (x - xmin), xmaxv = x + violinwidth * (xmax - x))
  grp <- data[1,'group']
  newdata <- plyr::arrange(transform(data, x = if(grp%%2==1) xminv else xmaxv), if(grp%%2==1) y else -y)
  newdata <- rbind(newdata[1, ], newdata, newdata[nrow(newdata), ], newdata[1, ])
  newdata[c(1,nrow(newdata)-1,nrow(newdata)), 'x'] <- round(newdata[1, 'x']) 
  if (length(draw_quantiles) > 0 & !scales::zero_range(range(data$y))) {
    stopifnot(all(draw_quantiles >= 0), all(draw_quantiles <= 
                                              1))
    quantiles <- ggplot2:::create_quantile_segment_frame(data, draw_quantiles)
    aesthetics <- data[rep(1, nrow(quantiles)), setdiff(names(data), c("x", "y")), drop = FALSE]
    aesthetics$alpha <- rep(1, nrow(quantiles))
    both <- cbind(quantiles, aesthetics)
    quantile_grob <- GeomPath$draw_panel(both, ...)
    ggplot2:::ggname("geom_split_violin", grid::grobTree(GeomPolygon$draw_panel(newdata, ...), quantile_grob))
  }
  else {
    ggplot2:::ggname("geom_split_violin", GeomPolygon$draw_panel(newdata, ...))
  }
})

geom_split_violin <- function (mapping = NULL, data = NULL, stat = "ydensity", position = "identity", ..., draw_quantiles = NULL, trim = TRUE, scale = "area", na.rm = FALSE, show.legend = NA, inherit.aes = TRUE) {
  layer(data = data, mapping = mapping, stat = stat, geom = GeomSplitViolin, position = position, show.legend = show.legend, inherit.aes = inherit.aes, params = list(trim = trim, scale = scale, draw_quantiles = draw_quantiles, na.rm = na.rm, ...))
}

```


**0 = Search without categorizing** 

**1 = Categorize then search**

**NOTE:** Difference scores calculated as the *Search* condition minius *Organization* condition. Positive scores mean that organization is perceived to take less time than search. Proportion scores are calculated as *(Search-Organization)/Organization*


# Experiment 1 Only

```{r}
# create data frame to make stack plot

lab<-subset(df, StudyType=="In Lab")
lab.ex<-subset(lab, Exclusion!="Exclude")

e1<-subset(df, Study=="In Lab E1")
e1.ex<-subset(e1, Exclusion!="Exclude")

```

## Choice (Pre & Post-Task)

```{r}
pre.choice<-melt(lab[-c(31)], id=c(1:29, 31:35)) # create a long data frame of just pre-task choice
post.choice<-melt(lab.ex[-c(30)], id=c(1:29, 31:35)) # create a long data frame of just post-task choice
lab.choice<-rbind(pre.choice, post.choice) # binding the two dataframes together
names(lab.choice)[c(35, 36)]<-c("PrePostChoice", "Choice.Num")
lab.choice$PrePostChoice<-factor(recode(lab.choice$PrePostChoice, "'Choice.Num'='Pre-Task Choice';
                                 'FutureChoice.Num'='Post-Task Choice'"))
lab.choice$PrePostChoice<-factor(lab.choice$PrePostChoice, levels(lab.choice$PrePostChoice)[c(2,1)])
```

```{r}
graph2<-ddply(lab.choice[lab.choice$Study=="In Lab E1",], c("Study", "PrePostChoice"), function(df)   
  return(c(dep.avg=mean(df$Choice.Num, na.rm=T), dep.sd=sd(df$Choice.Num, na.rm=T), dep.count=length(df$Choice.Num), 
           dep.sem=(sd(df$Choice.Num))/(sqrt(length(df$Choice.Num))))))

ggplot(graph2, aes(x=Study, y=dep.avg, colour=PrePostChoice))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  # scale_colour_manual(labels=c("#7294D4", "#7294D4","#7294D4","#7294D4"))
  geom_hline(yintercept = .5, linetype="dotted")+
  scale_colour_manual(values=wes_palette("IsleofDogs1", n = 2, type="discrete"))+
  scale_x_discrete("Experiment")+
  scale_y_continuous("Proportion Choosing 'Organize First'", breaks=seq(-1, 1, 0.1))+
  coord_cartesian(ylim = c(0, 1)) 

```

```{r}
e1.pre<-glm(Choice.Num ~ PreTimeDiff, family="binomial", data=e1)
tab_model(e1.pre, transform=NULL, show.stat = T, digits.p=2)
```

## Time Estimate and Actual Task Time

### Stack Bargraphs

```{r}
# pre-task estimation
# e1.est<-melt(e1[c(1:6, 11:13)], id=c(1:6))
# names(e1.est)[c(7,8)]<- c("Task", "Time")
# e1.est$Strategy<-factor(ifelse(e1.est$Task=="Time_SearchTotal", "Search Only", "Organize First"))
# e1.est$Strategy<-factor(e1.est$Strategy, levels(e1.est$Strategy)[c(2,1)])
# e1.est$Task<-factor(recode(e1.est$Task, "'Time_SearchTotal'='Search';
#                            'Time_Org.OrgSub'='Organization'; 'Time_Org.SearchSub'='Search'"))
# e1.est$Task<-factor(e1.est$Task, levels(e1.est$Task)[c(2,1)])
# e1.est$PrePostTask<-"Pre-Task Estimation"
# 
# # post-task estimation
# e1p.est<-melt(e1.ex[c(1:6, 21, 23, 24)], id=c(1:6))
# names(e1p.est)[c(7,8)]<- c("Task", "Time")
# e1p.est$Strategy<-factor(ifelse(e1p.est$Task=="PostTime_SearchTotal", "Search Only", "Organize First"))
# e1p.est$Strategy<-factor(e1p.est$Strategy, levels(e1p.est$Strategy)[c(2,1)])
# e1p.est$Task<-factor(recode(e1p.est$Task, "'PostTime_SearchTotal'='Search';
#                            'PostTime_Org.OrgSub'='Organization'; 'PostTime_Org.SearchSub'='Search'"))
# e1p.est$Task<-factor(e1p.est$Task, levels(e1p.est$Task)[c(2,1)])
# e1p.est$PrePostTask<-"Post-Task Estimation"
# 
# # Actual task time
# e1a.est<-melt(e1.ex[c(1:6, 18:19)], id=c(1:6))
# names(e1a.est)[c(7,8)]<- c("Task", "Time")
# e1a.est<-e1a.est[!is.na(e1a.est$Time),]
# e1a.est$Strategy<-e1a.est$Condition
# e1a.est$Task<-factor(recode(e1a.est$Task, "'ActualTime_Org'='Organization';
#                             'ActualTime_Search'='Search'"))
# e1a.est$Task<-factor(e1a.est$Task, levels(e1a.est$Task)[c(2,1)])
# e1a.est$PrePostTask<-"Actual Task Time"
# 
# # combine the two data frames
# e1.all.est<-rbind(e1.est, e1p.est, e1a.est)
# e1.all.est$PrePostTask<-factor(e1.all.est$PrePostTask)
# e1.all.est$PrePostTask<-factor(e1.all.est$PrePostTask, levels(e1.all.est$PrePostTask)[c(1,3,2)])
```


```{r}
# # stack plot template
# graph2<-ddply(e1.all.est, c("PrePostTask", "Strategy", "Task"), function(df)   
#   return(c(dep.avg=mean(df$Time), dep.sd=sd(df$Time), dep.count=length(df$Time), 
#            dep.sem=(sd(df$Time))/(sqrt(length(df$Time))))))
# print(graph2)
# 
# ggplot(graph2, aes(x=Strategy, y=dep.avg, fill=Task))+ 
#   geom_bar(stat="identity", width= 0.4)+
#   facet_grid(.~PrePostTask)+
#   theme(
#     panel.background= element_rect(fill=NA), # transparent panel
#     plot.background = element_rect(fill=NA, colour=NA), #transparent background
#     panel.grid=element_blank(), # remove panel grid
#     axis.ticks.x=element_blank(), # remove tick marks on x-axis
#     axis.ticks=element_line(colour="#A18882"), # change colour of tick marks
#     panel.border = element_rect(fill="transparent", colour="#A18882"), # change panel border colour
#     legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
#     axis.text = element_text(color="#432620"),
#     legend.key = element_rect(fill = "transparent", colour = "transparent")
#     # ,legend.position="none"
#   )+
#   scale_x_discrete(name="Strategy")+
#   scale_fill_manual("Task Component", values=c("#fbd17b", "#8fd2d4"))+
#   scale_y_continuous("Estimated Task Completion Time (min)", limits=c(0, 36), breaks=seq(0, 100, 5),
#                      expand=c(0,0))

```


### Cumulative Time Bargraphs

```{r}
time.cum<-melt(e1.ex[c(1:6, 10, 13, 21, 22)], id=c(1:6), value.name="Time")
time.cum$PrePostTask<-factor(ifelse(time.cum$variable=="Time_OrgTotal"|time.cum$variable=="Time_SearchTotal",
                                "Pre-Task Estimation", "Post-Task Estimation"))
time.cum$Strategy<-factor(ifelse(time.cum$variable=="Time_OrgTotal"|time.cum$variable=="PostTime_OrgTotal",
                                "Organize First", "Search Only"))

time.act<-melt(e1.ex[c(1:6, 20)], id=c(1:6), value.name="Time")
time.act$PrePostTask<-factor("Actual Task Time")
time.act$Strategy<-factor(time.act$Condition)

time.comb<-rbind(time.cum, time.act)
time.comb$PrePostTask<-factor(time.comb$PrePostTask, levels(time.comb$PrePostTask)[c(3,2,1)])
time.comb$Strategy<-factor(time.comb$Strategy, levels(time.comb$Strategy)[c(2,1)])

```


```{r}
graph2<-ddply(time.comb, c("PrePostTask", "Strategy"), function(df)   
  return(c(dep.avg=mean(df$Time, na.rm=T), dep.sd=sd(df$Time, na.rm=T),
           dep.count=length(df$Time), 
           dep.sem=(sd(df$Time))/(sqrt(length(df$Time))))))

# png('E1 Time Estimate.png', bg="transparent", width = 6, height = 4, units = 'in', res = 300)

ggplot(graph2, aes(x=Strategy, y=dep.avg))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5))+
  facet_grid(.~PrePostTask)+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  scale_y_continuous("Time", breaks=seq(0, 50, 5), limits=c(0, 40))

  # scale_colour_manual(labels=c("#7294D4", "#7294D4","#7294D4","#7294D4"))
  # geom_hline(yintercept = .5, linetype="dotted")+
  # scale_colour_manual(values=wes_palette("IsleofDogs1", n = 2, type="discrete"))+
  # scale_x_discrete("Experiment")+
  # coord_cartesian(ylim = c(0, 1)) 

```


```{r}
e1.time<-ezANOVA(data=time.cum, wid=.(ID), dv=.(Time), within=.(PrePostTask, Strategy), detailed=T)
print(e1.time)

```



## Post Task Choice Models

```{r}
e1.postchoice1<-glm(FutureChoice.Num ~ PreTimeDiff, family="binomial", data=e1.ex)
e1.postchoice2<-glm(FutureChoice.Num ~ PostTimeDiff, family="binomial", data=e1.ex)
e1.postchoice3<-glm(FutureChoice.Num ~ PreTimeDiff+PostTimeDiff, family="binomial", data=e1.ex)
e1.postchoice4<-glm(FutureChoice.Num ~ Choice+PreTimeDiff+PostTimeDiff, family="binomial", data=e1.ex)
e1.postchoice5<-glm(FutureChoice.Num ~ Condition+PreTimeDiff+PostTimeDiff, family="binomial", data=e1.ex)
e1.postchoice6<-glm(FutureChoice.Num ~ Choice+PreTimeDiff+Condition+PostTimeDiff, family="binomial", data=e1.ex)

tab_model(e1.postchoice1, e1.postchoice2, e1.postchoice3, transform=NULL, show.stat = T, digits.p=2)
tab_model(e1.postchoice4, e1.postchoice5, e1.postchoice6, transform=NULL, show.stat = T, digits.p=2)

```


## Task Switch

```{r}
graph2<-ddply(e1.ex, c("Choice"), function(df)   
  return(c(dep.avg=mean(df$Switch.Num), dep.sd=sd(df$Switch.Num), dep.count=length(df$Switch.Num), 
           dep.sem=(sd(df$Switch.Num))/(sqrt(length(df$Switch.Num))))))
# print(graph2)

ggplot(graph2, aes(x=Choice, y=dep.avg, colour=Choice))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0.05, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="#A18882"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="#A18882"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    ,legend.position="none"
  )+
  scale_colour_manual(values=c("maroon", "maroon"))+
  scale_x_discrete("Pre-Task Choice")+
  scale_y_continuous("Proportion Post-Task Choice Switch", breaks=seq(-1, 1, 0.2))+
  coord_cartesian(ylim = c(-0.1, 1)) 

```

```{r}
t.test(e1.ex$Switch.Num~e1.ex$Choice)
```


## Task Progress by Objects

```{r}


```































# Experiment 2 Only

```{r}
e2<-subset(lab, Study=="In Lab E2")
e2.ex<-subset(lab.ex, Study=="In Lab E2")
```

## Choice (Pre & Post-Task)

```{r}
graph2<-ddply(lab.choice[lab.choice$Study=="In Lab E2",], c("Study", "PrePostChoice"), function(df)   
  return(c(dep.avg=mean(df$Choice.Num, na.rm=T), dep.sd=sd(df$Choice.Num, na.rm=T), dep.count=length(df$Choice.Num), 
           dep.sem=(sd(df$Choice.Num))/(sqrt(length(df$Choice.Num))))))

ggplot(graph2, aes(x=Study, y=dep.avg, colour=PrePostChoice))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  # scale_colour_manual(labels=c("#7294D4", "#7294D4","#7294D4","#7294D4"))
  geom_hline(yintercept = .5, linetype="dotted")+
  scale_colour_manual(values=wes_palette("IsleofDogs1", n = 2, type="discrete"))+
  scale_x_discrete("Experiment")+
  scale_y_continuous("Proportion Choosing 'Organize First'", breaks=seq(-1, 1, 0.1))+
  coord_cartesian(ylim = c(0, 1)) 

```

```{r}
e2.pre<-glm(Choice.Num ~ PreTimeDiff, family="binomial", data=e2)
tab_model(e2.pre, transform=NULL, show.stat = T, digits.p=2)
```

## Time Estimate and Actual Task Time

### Stack Bargraphs

```{r}
# # pre-task estimation
# e2.est<-melt(e2[c(1:6, 11:13)], id=c(1:6))
# names(e2.est)[c(7,8)]<- c("Task", "Time")
# e2.est$Strategy<-factor(ifelse(e2.est$Task=="Time_SearchTotal", "Search Only", "Organize First"))
# e2.est$Strategy<-factor(e2.est$Strategy, levels(e2.est$Strategy)[c(2,1)])
# e2.est$Task<-factor(recode(e2.est$Task, "'Time_SearchTotal'='Search';
#                            'Time_Org.OrgSub'='Organization'; 'Time_Org.SearchSub'='Search'"))
# e2.est$Task<-factor(e2.est$Task, levels(e2.est$Task)[c(2,1)])
# e2.est$PrePostTask<-"Pre-Task Estimation"
# 
# # post-task estimation
# e2p.est<-melt(e2.ex[c(1:6, 21, 23, 24)], id=c(1:6))
# names(e2p.est)[c(7,8)]<- c("Task", "Time")
# e2p.est$Strategy<-factor(ifelse(e2p.est$Task=="PostTime_SearchTotal", "Search Only", "Organize First"))
# e2p.est$Strategy<-factor(e2p.est$Strategy, levels(e2p.est$Strategy)[c(2,1)])
# e2p.est$Task<-factor(recode(e2p.est$Task, "'PostTime_SearchTotal'='Search';
#                            'PostTime_Org.OrgSub'='Organization'; 'PostTime_Org.SearchSub'='Search'"))
# e2p.est$Task<-factor(e2p.est$Task, levels(e2p.est$Task)[c(2,1)])
# e2p.est$PrePostTask<-"Post-Task Estimation"
# 
# # Actual task time
# e2a.est<-melt(e2.ex[c(1:6, 18:19)], id=c(1:6))
# names(e2a.est)[c(7,8)]<- c("Task", "Time")
# e2a.est<-e2a.est[!is.na(e2a.est$Time),]
# e2a.est$Strategy<-e2a.est$Condition
# e2a.est$Task<-factor(recode(e2a.est$Task, "'ActualTime_Org'='Organization';
#                             'ActualTime_Search'='Search'"))
# e2a.est$Task<-factor(e2a.est$Task, levels(e2a.est$Task)[c(2,1)])
# e2a.est$PrePostTask<-"Actual Task Time"
# 
# # combine the two data frames
# e2.all.est<-rbind(e2.est, e2p.est, e2a.est)
# e2.all.est$PrePostTask<-factor(e2.all.est$PrePostTask)
# e2.all.est$PrePostTask<-factor(e2.all.est$PrePostTask, levels(e2.all.est$PrePostTask)[c(1,3,2)])
```


```{r}
# # stack plot template
# graph2<-ddply(e2.all.est, c("PrePostTask", "Strategy", "Task"), function(df)   
#   return(c(dep.avg=mean(df$Time), dep.sd=sd(df$Time), dep.count=length(df$Time), 
#            dep.sem=(sd(df$Time))/(sqrt(length(df$Time))))))
# print(graph2)
# 
# ggplot(graph2, aes(x=Strategy, y=dep.avg, fill=Task))+ 
#   geom_bar(stat="identity", width= 0.4)+
#   facet_grid(.~PrePostTask)+
#   theme(
#     panel.background= element_rect(fill=NA), # transparent panel
#     plot.background = element_rect(fill=NA, colour=NA), #transparent background
#     panel.grid=element_blank(), # remove panel grid
#     axis.ticks.x=element_blank(), # remove tick marks on x-axis
#     axis.ticks=element_line(colour="#A18882"), # change colour of tick marks
#     panel.border = element_rect(fill="transparent", colour="#A18882"), # change panel border colour
#     legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
#     axis.text = element_text(color="#432620"),
#     legend.key = element_rect(fill = "transparent", colour = "transparent")
#     # ,legend.position="none"
#   )+
#   scale_x_discrete(name="Strategy")+
#   scale_fill_manual("Task Component", values=c("#fbd17b", "#8fd2d4"))+
#   scale_y_continuous("Estimated Task Completion Time (min)", limits=c(0, 36), breaks=seq(0, 100, 5),
#                      expand=c(0,0))

```


### Cumulative Time Bargraphs

```{r}
time.cum<-melt(e2.ex[c(1:6, 10, 13, 21, 22)], id=c(1:6), value.name="Time")
time.cum$PrePostTask<-factor(ifelse(time.cum$variable=="Time_OrgTotal"|time.cum$variable=="Time_SearchTotal",
                                "Pre-Task Estimation", "Post-Task Estimation"))
time.cum$Strategy<-factor(ifelse(time.cum$variable=="Time_OrgTotal"|time.cum$variable=="PostTime_OrgTotal",
                                "Organize First", "Search Only"))

time.act<-melt(e2.ex[c(1:6, 20)], id=c(1:6), value.name="Time")
time.act$PrePostTask<-factor("Actual Task Time")
time.act$Strategy<-factor(time.act$Condition)

time.comb<-rbind(time.cum, time.act)
time.comb$PrePostTask<-factor(time.comb$PrePostTask, levels(time.comb$PrePostTask)[c(3,2,1)])
time.comb$Strategy<-factor(time.comb$Strategy, levels(time.comb$Strategy)[c(2,1)])

```


```{r}
graph2<-ddply(time.comb, c("PrePostTask", "Strategy"), function(df)   
  return(c(dep.avg=mean(df$Time, na.rm=T), dep.sd=sd(df$Time, na.rm=T),
           dep.count=length(df$Time), 
           dep.sem=(sd(df$Time))/(sqrt(length(df$Time))))))

ggplot(graph2, aes(x=Strategy, y=dep.avg))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5))+
  facet_grid(.~PrePostTask)+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  scale_y_continuous("Time", breaks=seq(0, 50, 5), limits=c(0, 40))

  # scale_colour_manual(labels=c("#7294D4", "#7294D4","#7294D4","#7294D4"))
  # geom_hline(yintercept = .5, linetype="dotted")+
  # scale_colour_manual(values=wes_palette("IsleofDogs1", n = 2, type="discrete"))+
  # scale_x_discrete("Experiment")+
  # coord_cartesian(ylim = c(0, 1)) 

```


```{r}
e2.time<-ezANOVA(data=time.cum, wid=.(ID), dv=.(Time), within=.(PrePostTask, Strategy), detailed=T)
print(e2.time)

```

## Task Progress (Minutes Left)

```{r}
probe.raw<-read.csv("E2 Progress.csv")
probe<- probe.raw[!is.na(probe.raw$PromptTime&probe.raw$Response),]
e2probe<-merge(e2.ex, probe[-c(2)], by="ID", all.x=T, all.y = F)
e2probe$Progress<-e2probe$PromptTime/e2probe$ActualTime_Total

prog<-subset(e2probe, !(ID=="333238"))

```

### "Unstandardized" Progress

```{r}
ggplot(prog, aes(x=PromptTime, y=Response, colour=Condition))+
  geom_point(size = 3)+
  scale_colour_manual(values = wes_palette("GrandBudapest1", 2))+
  geom_smooth(formula = y~x, method = loess, se=F)+
  scale_y_continuous("Estimated Time Remaining", limits=c(0, 49))+
  scale_x_continuous("Actual Time In Task")+
  theme(# remove the background & grid altogether
    panel.background= element_rect(fill=NA), 
    plot.background = element_rect(fill=NA, colour=NA),
    panel.grid.minor=element_blank(), 
    axis.ticks.x=element_blank(),
    panel.border = element_rect(fill="transparent", colour="grey"))
```


### "Standardized" Progress

```{r}
ggplot(prog, aes(x=Progress, y=Response, colour=Condition))+
  geom_point(size = 3)+
  scale_colour_manual(values = wes_palette("GrandBudapest1", 2))+
  geom_smooth(formula = y~x, method = loess, se=F)+
  scale_y_continuous("Estimated Time Remaining", limits=c(0, 49))+
  scale_x_continuous("Standardized Progress")+
  theme(# remove the background & grid altogether
    panel.background= element_rect(fill=NA), 
    plot.background = element_rect(fill=NA, colour=NA),
    panel.grid.minor=element_blank(), 
    axis.ticks.x=element_blank(),
    panel.border = element_rect(fill="transparent", colour="grey"))
```


```{r}
prog$Progress.c<-prog$Progress-mean(prog$Progress)
prog$PromptTime.c<- prog$PromptTime-mean(prog$PromptTime)

prog.std<-lmer(Response~Progress.c*Condition+(1|ID), data = prog, REML=F, na.action="na.omit",
               contrasts=list(Condition="contr.sum"))
tab_model(prog.std, transform=NULL, show.stat = T, p.val = "wald", digits = 3)

prog.unstd<-lmer(Response~PromptTime.c*Condition+(1|ID), data = prog, REML=F, na.action="na.omit",
                 contrasts=list(Condition="contr.sum"))
ss <- getME(prog.unstd, c("theta","fixef"))
prog.unstd2 <- update(prog.unstd, start=ss, control=lmerControl(optCtrl=list(maxfun=2e4)))
tab_model(prog.unstd, transform=NULL, show.stat = T, p.val = "wald", digits = 3)

```

### Individual

```{r, warning=F}
ggplot(prog, aes(x=Progress, y=Response, colour=factor(ID)))+
  geom_point(size = 3)+
  facet_grid(.~Condition)+
  scale_colour_manual(values = colorRampPalette(brewer.pal(12, "Set3"))(length(unique(prog$ID))))+
  geom_smooth(formula = y~x, method = loess, se=F)+
  scale_y_continuous("Estimated Time", limits=c(0, 49))+
  theme(# remove the background & grid altogether
    panel.background= element_rect(fill=NA), 
    plot.background = element_rect(fill=NA, colour=NA),
    panel.grid.minor=element_blank(), 
    axis.ticks.x=element_blank(),
    panel.border = element_rect(fill="transparent", colour="grey",),
    legend.position = "None")
```


```{r, warning=F}
ggplot(prog, aes(x=PromptTime, y=Response, colour=factor(ID)))+
  geom_point(size = 3)+
  facet_grid(.~Condition)+
  scale_colour_manual(values = colorRampPalette(brewer.pal(12, "Set3"))(length(unique(prog$ID))))+
  geom_smooth(formula = y~x, method = loess, se=F)+
  scale_y_continuous("Estimated Time", limits=c(0, 49))+
  theme(# remove the background & grid altogether
    panel.background= element_rect(fill=NA), 
    plot.background = element_rect(fill=NA, colour=NA),
    panel.grid.minor=element_blank(), 
    axis.ticks.x=element_blank(),
    panel.border = element_rect(fill="transparent", colour="grey",),
    legend.position = "None")
```

## Post Task Choice Models

```{r}
e2.postchoice1<-glm(FutureChoice.Num ~ PreTimeDiff, family="binomial", data=e2.ex)
e2.postchoice2<-glm(FutureChoice.Num ~ PostTimeDiff, family="binomial", data=e2.ex)
e2.postchoice3<-glm(FutureChoice.Num ~ PreTimeDiff+PostTimeDiff, family="binomial", data=e2.ex)
e2.postchoice4<-glm(FutureChoice.Num ~ Choice+PreTimeDiff+PostTimeDiff, family="binomial", data=e2.ex)
e2.postchoice5<-glm(FutureChoice.Num ~ Condition+PreTimeDiff+PostTimeDiff, family="binomial", data=e2.ex)
e2.postchoice6<-glm(FutureChoice.Num ~ Choice+PreTimeDiff+Condition+PostTimeDiff, family="binomial", data=e2.ex)

tab_model(e2.postchoice1, e2.postchoice2, e2.postchoice3, transform=NULL, show.stat = T, digits.p=2)
tab_model(e2.postchoice4, e2.postchoice5, e2.postchoice6, transform=NULL, show.stat = T, digits.p=2)

```


## Task Switch

```{r}
graph2<-ddply(e2.ex, c("Choice"), function(df)   
  return(c(dep.avg=mean(df$Switch.Num), dep.sd=sd(df$Switch.Num), dep.count=length(df$Switch.Num), 
           dep.sem=(sd(df$Switch.Num))/(sqrt(length(df$Switch.Num))))))
# print(graph2)

ggplot(graph2, aes(x=Choice, y=dep.avg, colour=Choice))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0.05, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="#A18882"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="#A18882"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    ,legend.position="none"
  )+
  scale_colour_manual(values=c("maroon", "maroon"))+
  scale_x_discrete("Pre-Task Choice")+
  scale_y_continuous("Proportion Post-Task Choice Switch", breaks=seq(-1, 1, 0.2))+
  coord_cartesian(ylim = c(-0.1, 1)) 

```

```{r}
t.test(e2.ex$Switch.Num~e2.ex$Choice)
```



# E1 E2 combined

```{r}
e1e2<-subset(lab, Study=="In Lab E1"|Study=="In Lab E2")
e1e2.ex<-subset(lab.ex, Study=="In Lab E1"|Study=="In Lab E2")

```

## Post-Task Choice

```{r}
e1e2.post1<-glm(FutureChoice.Num ~ PreTimeDiff, family="binomial", data=e1e2.ex)
e1e2.post2<-glm(FutureChoice.Num ~ PostTimeDiff, family="binomial", data=e1e2.ex)
e1e2.post3<-glm(FutureChoice.Num ~ PreTimeDiff+PostTimeDiff, family="binomial", data=e1e2.ex)
e1e2.post4<-glm(FutureChoice.Num ~ Choice+PreTimeDiff+PostTimeDiff, family="binomial", data=e1e2.ex)
e1e2.post5<-glm(FutureChoice.Num ~ Condition+PreTimeDiff+PostTimeDiff, family="binomial", data=e1e2.ex)
e1e2.post6<-glm(FutureChoice.Num ~ Choice+PreTimeDiff+Condition+PostTimeDiff, family="binomial", data=e1e2.ex)

tab_model(e1e2.post1, e1e2.post2, e1e2.post3, transform=NULL, show.stat = T, digits.p=2)
tab_model(e1e2.post4, e1e2.post5, e1e2.post6, transform=NULL, show.stat = T, digits.p=2)


```
































# Experiment 3 Only

```{r}
e3<-subset(lab, Study=="In Lab E3")
e3.ex<-subset(lab.ex, Study=="In Lab E3")
```

## Choice (Pre & Post-Task)

```{r}
graph2<-ddply(lab.choice[lab.choice$Study=="In Lab E3",], c("Study", "PrePostChoice"), function(df)   
  return(c(dep.avg=mean(df$Choice.Num, na.rm=T), dep.sd=sd(df$Choice.Num, na.rm=T), dep.count=length(df$Choice.Num), 
           dep.sem=(sd(df$Choice.Num))/(sqrt(length(df$Choice.Num))))))

ggplot(graph2, aes(x=Study, y=dep.avg, colour=PrePostChoice))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  # scale_colour_manual(labels=c("#7294D4", "#7294D4","#7294D4","#7294D4"))
  geom_hline(yintercept = .5, linetype="dotted")+
  scale_colour_manual(values=wes_palette("IsleofDogs1", n = 2, type="discrete"))+
  scale_x_discrete("Experiment")+
  scale_y_continuous("Proportion Choosing 'Organize First'", breaks=seq(-1, 1, 0.1))+
  coord_cartesian(ylim = c(0, 1)) 

```

```{r}
e3.choice.pre<-glm(Choice.Num ~ EffDiff, family="binomial", data=e3)
tab_model(e3.choice.pre, transform = NULL, show.stat = T)
```


## Self-Reported Effort

```{r}
effort<-melt(e3[c(1:6, 14,15)], id=c(1:6), variable.name = "Strategy", value.name = "Effort")
effort$Strategy<-recode(effort$Strategy, "'Org.Eff'='Organize First'; 'Search.Eff'='Search Only'")

graph2<-ddply(effort, c("Strategy"), function(df)   
  return(c(dep.avg=mean(df$Effort, na.rm=T), dep.sd=sd(df$Effort, na.rm=T),
           dep.count=length(df$Effort), 
           dep.sem=(sd(df$Effort))/(sqrt(length(df$Effort))))))

ggplot(graph2, aes(x=Strategy, y=dep.avg))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  scale_y_continuous("Perceived Effort", breaks=seq(0, 10, 1), limits=c(0, 6))
```

```{r}
t.test(effort$Effort~effort$Strategy, paired=T)
```


## Task Progress (Proportion Task Completed)

```{r}
probe.raw<-read.csv("E3 Progress.csv")
names(probe.raw)<-c("Subject", "Condition", "Prompt", "PromptTime", "TotalDistance", "PromptDistance", "PerceivedProgress", "Comment", "ID")
probe<- probe.raw[!is.na(probe.raw$PromptTime & probe.raw$PromptDistance),]
e3probe<-merge(e3.ex, probe[-c(2)], by="ID", all.x=T, all.y = F) # remove redundant condition column
e3probe$Progress<-e3probe$PromptTime/e3probe$ActualTime_Total

prog<-subset(e3probe, !(ID=="321484"))
```

### "Unstandardized" Progress

```{r}
ggplot(prog, aes(x=PromptTime, y=PerceivedProgress, colour=Condition))+
  geom_point(size = 3)+
  scale_colour_manual(values = wes_palette("GrandBudapest1", 2))+
  geom_smooth(formula = y~x, method = loess, se=F)+
  scale_y_continuous("Perceived Progress Made", limits=c(0, 1))+
  scale_x_continuous("Actual Time In Task")+
  theme(# remove the background & grid altogether
    panel.background= element_rect(fill=NA), 
    plot.background = element_rect(fill=NA, colour=NA),
    panel.grid.minor=element_blank(), 
    axis.ticks.x=element_blank(),
    panel.border = element_rect(fill="transparent", colour="grey"))
```

### "Standardized" Progress

```{r}
ggplot(prog, aes(x=Progress, y=PerceivedProgress, colour=Condition))+
  geom_point(size = 3)+
  scale_colour_manual(values = wes_palette("GrandBudapest1", 2))+
  geom_smooth(formula = y~x, method = loess, se=F)+
  scale_y_continuous("Perceived Progress Made", limits=c(0, 1))+
  scale_x_continuous("Actual Time In Task")+
  theme(# remove the background & grid altogether
    panel.background= element_rect(fill=NA), 
    plot.background = element_rect(fill=NA, colour=NA),
    panel.grid.minor=element_blank(), 
    axis.ticks.x=element_blank(),
    panel.border = element_rect(fill="transparent", colour="grey"))
```

```{r}
prog$Progress.c<-prog$Progress-mean(prog$Progress)
prog$PromptTime.c<- prog$PromptTime-mean(prog$PromptTime)

prog.std<-lmer(PerceivedProgress~Progress.c*Condition+(Progress.c|ID), data = prog, REML=F, na.action="na.omit",
               contrasts=list(Condition="contr.sum"))
tab_model(prog.std, transform=NULL, show.stat = T, p.val = "wald", digits = 3)

prog.unstd<-lmer(PerceivedProgress~PromptTime.c*Condition+(PromptTime.c|ID), data = prog, REML=F, na.action="na.omit",
                 contrasts=list(Condition="contr.sum"))
ss <- getME(prog.unstd, c("theta","fixef"))
prog.unstd2 <- update(prog.unstd, start=ss, control=lmerControl(optCtrl=list(maxfun=2e4)))
tab_model(prog.unstd, transform=NULL, show.stat = T, p.val = "wald", digits = 3)
```


### Individual

```{r, warning=F}
ggplot(prog, aes(x=Progress, y=PerceivedProgress, colour=factor(ID)))+
  geom_point(size = 3)+
  facet_grid(.~Condition)+
  scale_colour_manual(values = colorRampPalette(brewer.pal(12, "Set3"))(length(unique(prog$ID))))+
  geom_smooth(formula = y~x, method = loess, se=F)+
  scale_y_continuous("Estimated Time", limits=c(0, 1))+
  theme(# remove the background & grid altogether
    panel.background= element_rect(fill=NA), 
    plot.background = element_rect(fill=NA, colour=NA),
    panel.grid.minor=element_blank(), 
    axis.ticks.x=element_blank(),
    panel.border = element_rect(fill="transparent", colour="grey",)
    ,legend.position = "None"
    )
```


```{r, warning=F}
ggplot(prog, aes(x=PromptTime, y=PerceivedProgress, colour=factor(ID)))+
  geom_point(size = 3)+
  facet_grid(.~Condition)+
  scale_colour_manual(values = colorRampPalette(brewer.pal(12, "Set3"))(length(unique(prog$ID))))+
  geom_smooth(formula = y~x, method = loess, se=F)+
  scale_y_continuous("Estimated Time", limits=c(0, 1))+
  theme(# remove the background & grid altogether
    panel.background= element_rect(fill=NA), 
    plot.background = element_rect(fill=NA, colour=NA),
    panel.grid.minor=element_blank(), 
    axis.ticks.x=element_blank(),
    panel.border = element_rect(fill="transparent", colour="grey",),
    legend.position = "None")
```

#### Curvilinear Relation?

```{r}
prog<-mutate(prog, Progress.c2 = Progress.c*Progress.c)

prog.std<-lmer(PerceivedProgress~Progress.c+Progress.c2*Condition+(Progress.c2|ID), data = prog, REML=F, na.action="na.omit",
               contrasts=list(Condition="contr.sum"))
tab_model(prog.std, transform=NULL, show.stat = T, p.val = "wald", digits = 3)
```


## Task Switch

```{r}
graph2<-ddply(e3.ex, c("Choice"), function(df)   
  return(c(dep.avg=mean(df$Switch.Num), dep.sd=sd(df$Switch.Num), dep.count=length(df$Switch.Num), 
           dep.sem=(sd(df$Switch.Num))/(sqrt(length(df$Switch.Num))))))
# print(graph2)

ggplot(graph2, aes(x=Choice, y=dep.avg, colour=Choice))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0.05, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="#A18882"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="#A18882"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    ,legend.position="none"
  )+
  scale_colour_manual(values=c("maroon", "maroon"))+
  scale_x_discrete("Pre-Task Choice")+
  scale_y_continuous("Proportion Post-Task Choice Switch", breaks=seq(-1, 1, 0.2))+
  coord_cartesian(ylim = c(-0.1, 1)) 

```

```{r}
t.test(e3.ex$Switch.Num~e3.ex$Choice)
```

# E1-3 Switch From Assigned Strategy?
```{r}
lab.ex$SwitchFromAssigned<-ifelse(lab.ex$Condition==lab.ex$Future.Choice, 0, 1)

graph2<-ddply(lab.ex, c("Study", "Condition"), function(df)   
  return(c(dep.avg=mean(df$SwitchFromAssigned), dep.sd=sd(df$SwitchFromAssigned),
           dep.count=length(df$SwitchFromAssigned), 
           dep.sem=(sd(df$SwitchFromAssigned))/(sqrt(length(df$SwitchFromAssigned))))))
# print(graph2)

ggplot(graph2, aes(x=Study, y=dep.avg, colour=Condition))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0.05, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="#A18882"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="#A18882"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  scale_colour_manual("Assigned\nStrategy", values=wes_palette("GrandBudapest2", 2))+
  scale_x_discrete("Study")+
  scale_y_continuous("Proportion Post-Task Choice Switch", breaks=seq(-1, 1, 0.2))
  # coord_cartesian(ylim = c(-0.1, 1)) 

```

```{r}
t.test(lab.ex[lab.ex$Study=="In Lab E1",]$SwitchFromAssigned~lab.ex[lab.ex$Study=="In Lab E1",]$Condition)
t.test(lab.ex[lab.ex$Study=="In Lab E2",]$SwitchFromAssigned~lab.ex[lab.ex$Study=="In Lab E2",]$Condition)
t.test(lab.ex[lab.ex$Study=="In Lab E3",]$SwitchFromAssigned~lab.ex[lab.ex$Study=="In Lab E3",]$Condition)
```




```{r}
graph2<-ddply(lab.ex, c("Study", "Condition"), function(df)   
  return(c(dep.avg=mean(df$FutureChoice.Num), dep.sd=sd(df$FutureChoice.Num),
           dep.count=length(df$FutureChoice.Num), 
           dep.sem=(sd(df$FutureChoice.Num))/(sqrt(length(df$FutureChoice.Num))))))
# print(graph2)

ggplot(graph2, aes(x=Study, y=dep.avg, colour=Condition))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0.05, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="#A18882"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="#A18882"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  scale_colour_manual("Assigned\nStrategy", values=wes_palette("GrandBudapest2", 2))+
  scale_x_discrete("Study")+
  scale_y_continuous("Proportion Post-Task Choosing Organization", breaks=seq(-1, 1, 0.2))
  # coord_cartesian(ylim = c(-0.1, 1)) 

```



```{r}
t.test(lab.ex[lab.ex$Study=="In Lab E1",]$FutureChoice.Num~lab.ex[lab.ex$Study=="In Lab E1",]$Condition)
t.test(lab.ex[lab.ex$Study=="In Lab E2",]$FutureChoice.Num~lab.ex[lab.ex$Study=="In Lab E2",]$Condition)
t.test(lab.ex[lab.ex$Study=="In Lab E3",]$FutureChoice.Num~lab.ex[lab.ex$Study=="In Lab E3",]$Condition)
```


```{r}
base.mod<-glm(Switch.Num~1, data = lab.ex, family=binomial(link="logit"))
mod2<-glm(Switch.Num~Choice, data = lab.ex, family=binomial(link="logit"))

tab_model(base.mod, mod2, transform="exp", show.stat = T, digits.p=2)
```










# Experiment 4-7 (Online Studies)

## Exclusion Criteria?

```{r}
ggplot(df, aes(x=Study, y=PreTimeDiff, fill=StudyType)) +
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1, fill="white")+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  scale_fill_manual(values=wes_palette("IsleofDogs1", n = 3, type="discrete"))+
  # scale_x_discrete("", labels="SONA Samples")+
  scale_y_continuous("Relative Time Difference\n(Search - Organization)", breaks=seq(-100, 300, 20))+
  geom_hline(yintercept = c(50, -60), linetype="dotted")

```

# Mturk sample

```{r}
turk<-subset(df, PreTimeDiff<=50 & Study %in% c("Mturk E2", "Mturk E3"))[!is.na(subset(df, PreTimeDiff<=50 & Study %in% c("Mturk E2", "Mturk E3"))$EffDiff),]
turk2<-subset(turk, Study=="Mturk E2")
turk3<-subset(turk, Study=="Mturk E3")

```


## Choice (Pre & Post-Task) {.tabset}

```{r}
graph2<-ddply(turk, .(Study), function(df)   
  return(c(dep.avg=mean(df$Choice.Num, na.rm=T), dep.sd=sd(df$Choice.Num, na.rm=T), dep.count=length(df$Choice.Num), 
           dep.sem=(sd(df$Choice.Num))/(sqrt(length(df$Choice.Num))))))

ggplot(graph2, aes(x=Study, y=dep.avg))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5),colour=wes_palette("IsleofDogs1", n = 1, type="discrete"))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5),
                colour=wes_palette("IsleofDogs1", n = 1, type="discrete"))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  # scale_colour_manual(labels=c("#7294D4", "#7294D4","#7294D4","#7294D4"))
  geom_hline(yintercept = .5, linetype="dotted")+
  # scale_colour_manual(values=wes_palette("IsleofDogs1", n = 2, type="discrete"))+
  scale_x_discrete("MTurk Samples", labels=c("E4", "E5", "E4c"))+
  scale_y_continuous("Proportion Choosing 'Organize First'", breaks=seq(-1, 1, 0.1))+
  coord_cartesian(ylim = c(0, 1)) 

```


### E4
```{r}
e4.1<-glm(Choice.Num ~ PreTimeDiff, family=binomial(link=logit), data=turk2)
e4.2<-glm(Choice.Num ~ PreTimeDiff+EffDiff, family=binomial(link=logit), data=turk2)
e4.3<-glm(Choice.Num ~ PreTimeDiff+EffDiff+FunDiff, family=binomial(link=logit), data=turk2)

tab_model(e4.1, e4.2, e4.3, transform=NULL, show.stat = T, p.val = "wald", digits = 3)
```

### E5
```{r}
e5.1<-glm(Choice.Num ~ PreTimeDiff, family=binomial(link=logit), data=turk3)
e5.2<-glm(Choice.Num ~ PreTimeDiff+EffDiff, family=binomial(link=logit), data=turk3)
e5.3<-glm(Choice.Num ~ PreTimeDiff+EffDiff+FunDiff, family=binomial(link=logit), data=turk3)

tab_model(e5.1, e5.2, e5.3, transform=NULL, show.stat = T, p.val = "wald", digits = 3)

```

### Combined
```{r}
turk.1<-glm(Choice.Num ~ PreTimeDiff, family=binomial(link=logit), data=turk)
turk.2<-glm(Choice.Num ~ PreTimeDiff+EffDiff, family=binomial(link=logit), data=turk)
turk.3<-glm(Choice.Num ~ PreTimeDiff+EffDiff+FunDiff, family=binomial(link=logit), data=turk)

tab_model(turk.1, turk.2, turk.3, transform=NULL, show.stat = T, p.val = "wald", digits = 3)

```

## Correlation Matrix

```{r}
# E4
cormat<-cor(turk2[complete.cases(turk2[c(32,34,35)]), c(32,34,35)])
res1 <- cor.mtest(turk2[complete.cases(turk2[c(32,34,35)]), c(32,34,35)], conf.level = .95)
corrplot(cormat, p.mat = res1$p, sig.level = .05, type="upper",addCoef.col = "white",
         tl.col="black", tl.srt=45)

# E5
cormat<-cor(turk3[complete.cases(turk3[c(32,34,35)]), c(32,34,35)])
res1 <- cor.mtest(turk3[complete.cases(turk3[c(32,34,35)]), c(32,34,35)], conf.level = .95)
corrplot(cormat, p.mat = res1$p, sig.level = .05, type="upper",addCoef.col = "white",
         tl.col="black", tl.srt=45)

# combined
cormat<-cor(turk[complete.cases(turk[c(32,34,35)]), c(32,34,35)])
res1 <- cor.mtest(turk[complete.cases(turk[c(32,34,35)]), c(32,34,35)], conf.level = .95)
corrplot(cormat, p.mat = res1$p, sig.level = .05, type="upper",addCoef.col = "white",
         tl.col="black", tl.srt=45)
```


## Time Estimate 

```{r}
time.cum<-melt(turk[c(1:5, 10, 13)], id=c(1:5), value.name="Time", variable.name="Strategy")
time.cum$Strategy<-factor(recode(time.cum$Strategy, "'Time_OrgTotal'='Organize First';
                                 'Time_SearchTotal'='Search Only'"))
time.comb<-time.cum[!is.na(time.cum$Time),]
time.comb$Strategy<-factor(time.comb$Strategy, levels(time.comb$Strategy)[c(2,1)])

```


```{r}
graph2<-ddply(time.comb, c("Strategy", "Study"), function(df)   
  return(c(dep.avg=mean(df$Time, na.rm=T), dep.sd=sd(df$Time, na.rm=T),
           dep.count=length(df$Time), 
           dep.sem=(sd(df$Time))/(sqrt(length(df$Time))))))

# png('E1 Time Estimate.png', bg="transparent", width = 6, height = 4, units = 'in', res = 300)

ggplot(graph2, aes(x=Study, y=dep.avg, group=Strategy, colour=Strategy))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  scale_y_continuous("Time", breaks=seq(0, 50, 5))+
  scale_colour_manual(values=wes_palette("GrandBudapest1", n = 2, type="discrete"))+
  scale_x_discrete("Experiment", labels=c("E4", "E5"))+
  coord_cartesian(ylim = c(0, 45))

```

```{r}
t.test(turk2$Time_SearchTotal, turk2$Time_OrgTotal, paired=T)
t.test(turk3$Time_SearchTotal, turk3$Time_OrgTotal, paired=T)
# ezANOVA(data=time.comb, wid=.(ID), dv=.(Time), within=.(Strategy), between=.(Study),
#         detailed=T)
t.test(turk$PreTimeDiff~turk$Study)
```



## Perceived Effort

```{r}
eff.cum<-melt(turk[c(1:5, 14,15)], id=c(1:5), value.name="Effort", variable.name="Strategy")
eff.cum$Strategy<-factor(recode(eff.cum$Strategy, "'Org.Eff'='Organize First';
                                 'Search.Eff'='Search Only'"))
eff.cum$Strategy<-factor(eff.cum$Strategy, levels(eff.cum$Strategy)[c(2,1)])

```


```{r}
graph2<-ddply(eff.cum, c("Strategy", "Study"), function(df)   
  return(c(dep.avg=mean(df$Effort, na.rm=T), dep.sd=sd(df$Effort, na.rm=T),
           dep.count=length(df$Effort), 
           dep.sem=(sd(df$Effort))/(sqrt(length(df$Effort))))))

# png('E1 Time Estimate.png', bg="transparent", width = 6, height = 4, units = 'in', res = 300)

ggplot(graph2, aes(x=Study, y=dep.avg, colour=Strategy))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  scale_colour_manual(values=wes_palette("GrandBudapest1", n = 2, type="discrete"))+
  scale_x_discrete("Experiment", labels=c("E4", "E5"))+
  scale_y_continuous("Perceived Effort", breaks=seq(0, 10, 1), limits=c(0, 6))

```

```{r}
t.test(turk2$Org.Eff, turk2$Search.Eff, paired=T)
t.test(turk3$Org.Eff, turk3$Search.Eff, paired=T)
# ezANOVA(data=time.comb, wid=.(ID), dv=.(Time), within=.(Strategy), between=.(Study),
#         detailed=T)
t.test(turk$EffDiff~turk$Study)
```

## Perceived Enjoyment

```{r}
fun.cum<-melt(turk[turk$PreTimeDiff<100, c(1:5,16,17)], id=c(1:5), value.name="Fun", variable.name="Strategy")
fun.cum$Strategy<-factor(recode(fun.cum$Strategy, "'Org.Fun'='Organize First';
                                 'Search.Fun'='Search Only'"))
fun.cum$Strategy<-factor(fun.cum$Strategy, levels(fun.cum$Strategy)[c(2,1)])

```


```{r}
graph2<-ddply(fun.cum, c("Strategy", "Study"), function(df)   
  return(c(dep.avg=mean(df$Fun, na.rm=T), dep.sd=sd(df$Fun, na.rm=T),
           dep.count=length(df$Fun), 
           dep.sem=(sd(df$Fun))/(sqrt(length(df$Fun))))))

# png('E1 Time Estimate.png', bg="transparent", width = 6, height = 4, units = 'in', res = 300)

ggplot(graph2, aes(x=Study, y=dep.avg, colour=Strategy))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  scale_y_continuous("Enjoyability", breaks=seq(0, 10, 1), limits=c(0, 6))+
  scale_colour_manual(values=wes_palette("GrandBudapest1", n = 2, type="discrete"))+
  scale_x_discrete("Experiment", labels=c("E4", "E5"))

```

```{r}
# t.test(fun.cum$Fun~fun.cum$Strategy, paired=T)
t.test(turk2$Org.Fun, turk2$Search.Fun, paired=T)
t.test(turk3$Org.Fun, turk3$Search.Fun, paired=T)
t.test(turk$FunDiff~turk$Study)

```










# SONA sample

```{r}
sona<-subset(df, PreTimeDiff<=50 & Study %in% c("Sona E1", "Sona E2"))[!is.na(subset(df, PreTimeDiff<=50 & Study %in% c("Sona E1", "Sona E2"))$EffDiff),]
sona1<-subset(sona, Study=="Sona E1")
sona2<-subset(sona, Study=="Sona E2")
```


## Choice (Pre & Post-Task) {.tabset}

```{r}
graph2<-ddply(sona, .(Study), function(df)   
  return(c(dep.avg=mean(df$Choice.Num, na.rm=T), dep.sd=sd(df$Choice.Num, na.rm=T), dep.count=length(df$Choice.Num), 
           dep.sem=(sd(df$Choice.Num))/(sqrt(length(df$Choice.Num))))))

ggplot(graph2, aes(x=Study, y=dep.avg))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5),colour=wes_palette("IsleofDogs1", n = 1, type="discrete"))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5),
                colour=wes_palette("IsleofDogs1", n = 1, type="discrete"))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  # scale_colour_manual(labels=c("#7294D4", "#7294D4","#7294D4","#7294D4"))
  geom_hline(yintercept = .5, linetype="dotted")+
  # scale_colour_manual(values=wes_palette("IsleofDogs1", n = 2, type="discrete"))+
  scale_x_discrete("SONA Samples", labels=c("E6", "E7"))+
  scale_y_continuous("Proportion Choosing 'Organize First'", breaks=seq(-1, 1, 0.1))+
  coord_cartesian(ylim = c(0, 1)) 

```


### E6
```{r}
e6.1<-glm(Choice.Num ~ PreTimeDiff, family=binomial(link=logit), data=sona1)
e6.2<-glm(Choice.Num ~ PreTimeDiff+EffDiff, family=binomial(link=logit), data=sona1)
e6.3<-glm(Choice.Num ~ PreTimeDiff+EffDiff+FunDiff, family=binomial(link=logit), data=sona1)

tab_model(e6.1, e6.2, e6.3, transform=NULL, show.stat = T, p.val = "wald", digits = 3)
```

### E7
```{r}
e7.1<-glm(Choice.Num ~ PreTimeDiff, family=binomial(link=logit), data=sona2)
e7.2<-glm(Choice.Num ~ PreTimeDiff+EffDiff, family=binomial(link=logit), data=sona2)
e7.3<-glm(Choice.Num ~ PreTimeDiff+EffDiff+FunDiff, family=binomial(link=logit), data=sona2)

tab_model(e7.1, e7.2, e7.3, transform=NULL, show.stat = T, p.val = "wald", digits = 3)

```


### Combined
```{r}
sona.1<-glm(Choice.Num ~ PreTimeDiff, family=binomial(link=logit), data=sona)
sona.2<-glm(Choice.Num ~ PreTimeDiff+EffDiff, family=binomial(link=logit), data=sona)
sona.3<-glm(Choice.Num ~ PreTimeDiff+EffDiff+FunDiff, family=binomial(link=logit), data=sona)

tab_model(sona.1, sona.2, sona.3, transform=NULL, show.stat = T, p.val = "wald", digits = 3)

```

## Correlation Matrix

```{r}
# E4
cormat<-cor(sona1[complete.cases(sona1[c(32,34,35)]), c(32,34,35)])
res1 <- cor.mtest(sona1[complete.cases(sona1[c(32,34,35)]), c(32,34,35)], conf.level = .95)
corrplot(cormat, p.mat = res1$p, sig.level = .05, type="upper",addCoef.col = "white",
         tl.col="black", tl.srt=45)

# E5
cormat<-cor(sona2[complete.cases(sona2[c(32,34,35)]), c(32,34,35)])
res1 <- cor.mtest(sona2[complete.cases(sona2[c(32,34,35)]), c(32,34,35)], conf.level = .95)
corrplot(cormat, p.mat = res1$p, sig.level = .05, type="upper",addCoef.col = "white",
         tl.col="black", tl.srt=45)

# combined
cormat<-cor(sona[complete.cases(sona[c(32,34,35)]), c(32,34,35)])
res1 <- cor.mtest(sona[complete.cases(sona[c(32,34,35)]), c(32,34,35)], conf.level = .95)
corrplot(cormat, p.mat = res1$p, sig.level = .05, type="upper",addCoef.col = "white",
         tl.col="black", tl.srt=45)
```


## Time Estimate 

```{r}
time.cum<-melt(sona[c(1:5, 10, 13)], id=c(1:5), value.name="Time", variable.name="Strategy")
time.cum$Strategy<-factor(recode(time.cum$Strategy, "'Time_OrgTotal'='Organize First';
                                 'Time_SearchTotal'='Search Only'"))
time.comb<-time.cum[!is.na(time.cum$Time),]
time.comb$Strategy<-factor(time.comb$Strategy, levels(time.comb$Strategy)[c(2,1)])

```


```{r}
graph2<-ddply(time.comb, c("Strategy", "Study"), function(df)   
  return(c(dep.avg=mean(df$Time, na.rm=T), dep.sd=sd(df$Time, na.rm=T),
           dep.count=length(df$Time), 
           dep.sem=(sd(df$Time))/(sqrt(length(df$Time))))))

# png('E1 Time Estimate.png', bg="transparent", width = 6, height = 4, units = 'in', res = 300)

ggplot(graph2, aes(x=Study, y=dep.avg, group=Strategy, colour=Strategy))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  scale_y_continuous("Time", breaks=seq(0, 50, 5))+
  scale_colour_manual(values=wes_palette("GrandBudapest1", n = 2, type="discrete"))+
  scale_x_discrete("Experiment", labels=c("E4", "E5"))+
  coord_cartesian(ylim = c(0, 45))

```


```{r}
t.test(sona1$Time_SearchTotal, sona1$Time_OrgTotal, paired=T)
t.test(sona2$Time_SearchTotal, sona2$Time_OrgTotal, paired=T)
# ezANOVA(data=time.comb, wid=.(ID), dv=.(Time), within=.(Strategy), between=.(Study),
#         detailed=T)
t.test(sona$PreTimeDiff~sona$Study)
```



## Perceived Effort

```{r}
eff.cum<-melt(sona[c(1:5, 14,15)], id=c(1:5), value.name="Effort", variable.name="Strategy")
eff.cum$Strategy<-factor(recode(eff.cum$Strategy, "'Org.Eff'='Organize First';
                                 'Search.Eff'='Search Only'"))
eff.cum$Strategy<-factor(eff.cum$Strategy, levels(eff.cum$Strategy)[c(2,1)])

```


```{r}
graph2<-ddply(eff.cum, c("Strategy", "Study"), function(df)   
  return(c(dep.avg=mean(df$Effort, na.rm=T), dep.sd=sd(df$Effort, na.rm=T),
           dep.count=length(df$Effort), 
           dep.sem=(sd(df$Effort))/(sqrt(length(df$Effort))))))

# png('E1 Time Estimate.png', bg="transparent", width = 6, height = 4, units = 'in', res = 300)

ggplot(graph2, aes(x=Study, y=dep.avg, colour=Strategy))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  scale_colour_manual(values=wes_palette("GrandBudapest1", n = 2, type="discrete"))+
  scale_x_discrete("Experiment", labels=c("E4", "E5"))+
  scale_y_continuous("Perceived Effort", breaks=seq(0, 10, 1), limits=c(0, 6))

```

```{r}
t.test(sona1$Org.Eff, sona1$Search.Eff, paired=T)
t.test(sona2$Org.Eff, sona2$Search.Eff, paired=T)
# ezANOVA(data=time.comb, wid=.(ID), dv=.(Time), within=.(Strategy), between=.(Study),
#         detailed=T)
t.test(sona$EffDiff~sona$Study)
```

## Perceived Enjoyment

```{r}
fun.cum<-melt(sona[sona$PreTimeDiff<100, c(1:5,16,17)], id=c(1:5), value.name="Fun", variable.name="Strategy")
fun.cum$Strategy<-factor(recode(fun.cum$Strategy, "'Org.Fun'='Organize First';
                                 'Search.Fun'='Search Only'"))
fun.cum$Strategy<-factor(fun.cum$Strategy, levels(fun.cum$Strategy)[c(2,1)])

```


```{r}
graph2<-ddply(fun.cum, c("Strategy", "Study"), function(df)   
  return(c(dep.avg=mean(df$Fun, na.rm=T), dep.sd=sd(df$Fun, na.rm=T),
           dep.count=length(df$Fun), 
           dep.sem=(sd(df$Fun))/(sqrt(length(df$Fun))))))

# png('E1 Time Estimate.png', bg="transparent", width = 6, height = 4, units = 'in', res = 300)

ggplot(graph2, aes(x=Study, y=dep.avg, colour=Strategy))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  scale_y_continuous("Enjoyability", breaks=seq(0, 10, 1), limits=c(0, 6))+
  scale_colour_manual(values=wes_palette("GrandBudapest1", n = 2, type="discrete"))+
  scale_x_discrete("Experiment", labels=c("E4", "E5"))

```

```{r}
# t.test(fun.cum$Fun~fun.cum$Strategy, paired=T)
t.test(sona1$Org.Fun, sona1$Search.Fun, paired=T)
t.test(turk3$Org.Fun, turk3$Search.Fun, paired=T)
t.test(turk$FunDiff~turk$Study)

```

## Estimates (Range Plot) For E4-7

## Does estimated task time predict chosen strategy?

```{r}
# E1
coef.e1<-cbind(
  data.frame(Study="E1", 
             Model="Time",
             Variable=rownames(summary(e1.pre)$coefficients)),
             Count=nrow(df[df$Study=="In Lab E1",]),
  as.data.frame(summary(e1.pre)$ coefficients))

# E2
coef.e2<-cbind(
  data.frame(Study="E2", 
             Model="Time",
             Variable=rownames(summary(e2.pre)$coefficients)),
             Count=nrow(df[df$Study=="In Lab E2",]),
  as.data.frame(summary(e2.pre)$ coefficients))

# In lab Combined

inlab<-glm(Choice.Num ~ PreTimeDiff, family="binomial", 
         data=lab[lab$Study=="In Lab E1"|lab$Study=="In Lab E2",])

coef.lab<-cbind(
  data.frame(Study="In-Lab", 
             Model="Time",
             Variable=rownames(summary(inlab)$coefficients)),
             Count=nrow(lab[lab$Study=="In Lab E1"|lab$Study=="In Lab E2",]),
  as.data.frame(summary(inlab)$ coefficients))

# E4
coef.e4.1<-cbind(
  data.frame(Study="E4", 
             Model="Time",
             Variable=rownames(summary(e4.1)$coefficients)),
             Count=nrow(df[df$Study=="Mturk E2",]),
  as.data.frame(summary(e4.1)$ coefficients))

coef.e4.2<-cbind(
  data.frame(Study="E4", 
             Model="Time + Effort",
             Variable=rownames(summary(e4.2)$coefficients)),
             Count=nrow(df[df$Study=="Mturk E2",]),
  as.data.frame(summary(e4.2)$ coefficients))

coef.e4.3<-cbind(
  data.frame(Study="E4", 
             Model="Time + Effort + Enjoyability",
             Variable=rownames(summary(e4.3)$coefficients)),
             Count=nrow(df[df$Study=="Mturk E2",]),
  as.data.frame(summary(e4.3)$ coefficients))

# E5
coef.e5.1<-cbind(
  data.frame(Study="E5", 
             Model="Time",
             Variable=rownames(summary(e5.1)$coefficients)),
             Count=nrow(df[df$Study=="Mturk E3",]),
  as.data.frame(summary(e5.1)$ coefficients))

coef.e5.2<-cbind(
  data.frame(Study="E5", 
             Model="Time + Effort",
             Variable=rownames(summary(e5.2)$coefficients)),
             Count=nrow(df[df$Study=="Mturk E3",]),
  as.data.frame(summary(e5.2)$ coefficients))

coef.e5.3<-cbind(
  data.frame(Study="E5", 
             Model="Time + Effort + Enjoyability",
             Variable=rownames(summary(e5.3)$coefficients)),
             Count=nrow(df[df$Study=="Mturk E3",]),
  as.data.frame(summary(e5.3)$ coefficients))

# E6
coef.e6.1<-cbind(
  data.frame(Study="E6", 
             Model="Time",
             Variable=rownames(summary(e6.1)$coefficients)),
             Count=nrow(df[df$Study=="Sona E1",]),
  as.data.frame(summary(e6.1)$ coefficients))

coef.e6.2<-cbind(
  data.frame(Study="E6", 
             Model="Time + Effort",
             Variable=rownames(summary(e6.2)$coefficients)),
             Count=nrow(df[df$Study=="Sona E1",]),
  as.data.frame(summary(e6.2)$ coefficients))

coef.e6.3<-cbind(
  data.frame(Study="E6", 
             Model="Time + Effort + Enjoyability",
             Variable=rownames(summary(e6.3)$coefficients)),
             Count=nrow(df[df$Study=="Sona E1",]),
  as.data.frame(summary(e6.3)$ coefficients))


# E7
coef.e7.1<-cbind(
  data.frame(Study="E7", 
             Model="Time",
             Variable=rownames(summary(e7.1)$coefficients)),
             Count=nrow(df[df$Study=="Sona E2",]),
  as.data.frame(summary(e7.1)$ coefficients))

coef.e7.2<-cbind(
  data.frame(Study="E7", 
             Model="Time + Effort",
             Variable=rownames(summary(e7.2)$coefficients)),
             Count=nrow(df[df$Study=="Sona E2",]),
  as.data.frame(summary(e7.2)$ coefficients))

coef.e7.3<-cbind(
  data.frame(Study="E7", 
             Model="Time + Effort + Enjoyability",
             Variable=rownames(summary(e7.3)$coefficients)),
             Count=nrow(df[df$Study=="Sona E2",]),
  as.data.frame(summary(e7.3)$ coefficients))

# MTurk Samples Combined

coef.turk.1<-cbind(
  data.frame(Study="MTurk Samples", 
             Model="Time",
             Variable=rownames(summary(turk.1)$coefficients)),
             Count=nrow(df[df$Study=="Mturk E2"|df$Study=="Mturk E3",]),
  as.data.frame(summary(turk.1)$ coefficients))

coef.turk.2<-cbind(
  data.frame(Study="MTurk Samples", 
             Model="Time + Effort",
             Variable=rownames(summary(turk.2)$coefficients)),
             Count=nrow(df[df$Study=="Mturk E2"|df$Study=="Mturk E3",]),
  as.data.frame(summary(turk.2)$ coefficients))

coef.turk.3<-cbind(
  data.frame(Study="MTurk Samples", 
             Model="Time + Effort + Enjoyability",
             Variable=rownames(summary(turk.3)$coefficients)),
             Count=nrow(df[df$Study=="Mturk E2"|df$Study=="Mturk E3",]),
  as.data.frame(summary(turk.3)$ coefficients))

# SONA Samples Combined

coef.sona.1<-cbind(
  data.frame(Study="SONA Samples", 
             Model="Time",
             Variable=rownames(summary(sona.1)$coefficients)),
             Count=nrow(df[df$Study=="Sona E2"|df$Study=="Sona E3",]),
  as.data.frame(summary(sona.1)$ coefficients))

coef.sona.2<-cbind(
  data.frame(Study="SONA Samples", 
             Model="Time + Effort",
             Variable=rownames(summary(sona.2)$coefficients)),
             Count=nrow(df[df$Study=="Sona E2"|df$Study=="Sona E3",]),
  as.data.frame(summary(sona.2)$ coefficients))

coef.sona.3<-cbind(
  data.frame(Study="SONA Samples", 
             Model="Time + Effort + Enjoyability",
             Variable=rownames(summary(sona.3)$coefficients)),
             Count=nrow(df[df$Study=="Sona E2"|df$Study=="Sona E3",]),
  as.data.frame(summary(sona.3)$ coefficients))



# putting together data frame
models1<-rbind(coef.e1, coef.e2,
               coef.e4.1, coef.e4.2, coef.e4.3,
               coef.e5.1, coef.e5.2, coef.e5.3,
               coef.e6.1, coef.e6.2, coef.e6.3,
               coef.e7.1, coef.e7.2, coef.e7.3)
names(models1)[6:8]=c("SE", "zValue","pValue")

models2<-rbind(coef.lab,
               coef.turk.1, coef.turk.2, coef.turk.3,
               coef.sona.1, coef.sona.2, coef.sona.3)
names(models2)[6:8]=c("SE", "zValue","pValue")

```


```{r}
ggplot(models1, aes(x=Variable, y=Estimate, colour = Study, group=Study))+
  geom_hline(yintercept = 0, colour = "#7294D4", linetype="dotted", lwd=1)+
  geom_pointrange(aes(ymin=Estimate-SE*qt(0.975,df=Count-1), 
                      ymax=Estimate+SE*qt(0.975,df=Count-1)), 
                     lwd = 1, position = position_dodge(width = 1/2), shape = 16, fatten = 1.5)+
  facet_grid(.~Model)+
  coord_flip()+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # legend.position="none"
  )+
  scale_colour_manual(values=c(wes_palette(name="Moonrise2", n=2),
                               wes_palette(name="GrandBudapest1", n=4)))+
  scale_x_discrete("",labels=c("Intercept", "Time Estimate", "Perceived Effort", "Enjoyability"))
```



```{r}
ggplot(models2, aes(x=Variable, y=Estimate, colour = Study, group=Study))+
  geom_hline(yintercept = 0, colour = "#7294D4", linetype="dotted", lwd=1)+
  geom_pointrange(aes(ymin=Estimate-SE*qt(0.975,df=Count-1), 
                      ymax=Estimate+SE*qt(0.975,df=Count-1)), 
                     lwd = 1, position = position_dodge(width = 1/2), shape = 16, fatten = 1.5)+
  facet_grid(.~Model)+
  coord_flip()+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # legend.position="none"
  )+
  scale_colour_manual(values=wes_palette(name="Darjeeling1", n=3))+
  scale_x_discrete("",labels=c("Intercept", "Time Estimate", "Perceived Effort", "Enjoyability"))
```

## Do factors such as age/gender play a role?

```{r}
ind.turk<-glm(Choice.Num~PreTimeDiff+Age+Sex, family="binomial", data=turk)
tab_model(turk.1, ind.turk, transform = NULL)

ind.sona<-glm(Choice.Num~PreTimeDiff+Age+Sex, family="binomial", data=sona)
tab_model(sona.1, ind.sona, transform = NULL)

ind.lab<-glm(Choice.Num~PreTimeDiff+Age+Sex, family="binomial", data=lab[lab$Study=="In Lab E1"|lab$Study=="In Lab E2",])
tab_model(inlab, ind.lab, transform = NULL)

# different samples
ind.lab1<-glm(Choice.Num~PreTimeDiff+Sex, family="binomial", data=e1)
ind.lab2<-glm(Choice.Num~PreTimeDiff+Sex, family="binomial", data=e2)

tab_model(ind.lab, ind.lab1, ind.lab2, transform = NULL)

```


```{r}
used<-subset(df, !(Study %in% c("In Lab E3", "Mturk E1")|is.na(df$Age)|Sex=="O"))


graph2<-ddply(used, .(Study, Sex), function(df)   
  return(c(dep.avg=mean(df$Choice.Num, na.rm=T), dep.sd=sd(df$Choice.Num, na.rm=T), dep.count=length(df$Choice.Num), 
           dep.sem=(sd(df$Choice.Num))/(sqrt(length(df$Choice.Num))))))

ggplot(graph2, aes(x=Study, y=dep.avg, group=Sex, colour=Sex))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5))+
   geom_text(aes(label = dep.count, y = 1),position = position_dodge(0.5))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  geom_hline(yintercept = .5, linetype="dotted")+
  scale_colour_manual(values=wes_palette("Cavalcanti1", n = 2, type="discrete"))+
  # scale_x_discrete("MTurk Samples", labels=c("E4", "E5", "E4c"))+
  scale_y_continuous("Proportion Choosing 'Organize First'", breaks=seq(-1, 1, 0.1))+
  coord_cartesian(ylim = c(0, 1)) 
```

```{r}
online<-rbind(turk, sona)

online.mod<-glm(Choice.Num~PreTimeDiff*StudyType, family="binomial", data=online)
online.mod2<-glm(Choice.Num~PreTimeDiff+StudyType, family="binomial", data=online)

tab_model(online.mod2, online.mod, transform = NULL)

```


```{r}
t.test(online$Choice.Num~online$StudyType)
```










