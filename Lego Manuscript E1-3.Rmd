---
title: "Lego Manuscript (E1-3)"
author: Mona Zhu
date: Updated Oct 18, 2019
output: 
  html_document:
    fig_width: 8
    fig_height: 5
    toc: true
    toc_float: true
    theme: cerulean
    highlight: tango
    code_folding: hide
---

<style>
pre code, pre, code {
  overflow-y: auto !important;
  max-height: 20em;
}
</style>

```{r, warning = F, message = F}
library(car)
library(ggplot2)
library(plyr)
library(reshape2)
library(wesanderson)
library(corrplot)
library(BayesFactor)
library(sjPlot)
library(ez)
library(lme4)
library(RColorBrewer)
library(openxlsx)
library(corrplot)
library(ggalluvial)
```



```{r}
# setwd("C:/Users/monaj/Dropbox/CANB Lab/Lego & Search/Online Lego Study")
df<-read.csv("Lego_Combined In-Lab&Turk&SONA_3Sept2019.csv")

df$StudyType<-factor(ifelse(df$Study=="Sona E1"|df$Study=="Sona E2", "Sona", 
                     ifelse(df$Study=="Mturk E1"|df$Study=="Mturk E2"|df$Study=="Mturk E3", "Mturk", "In Lab")))

# Pre-Task Choice
df$Choice<-factor(recode(as.character(df$Choice), "''=NA; 'Categorize then search'='Organize First'; 
                  'Search without categorizing'='Search Only'"))
df$Choice<-factor(df$Choice, levels(df$Choice)[c(2,1)])
df$Choice.Num<-ifelse(df$Choice=="Organize First", 1, 0)

# Post-Task Choice (in-lab only)
df$Future.Choice<-factor(recode(as.character(df$Future.Choice), "''=NA; 'Categorize then search'='Organize First'; 
                         'Search without categorizing'='Search Only'"))
df$Future.Choice<-factor(df$Future.Choice, levels(df$Future.Choice)[c(2,1)])
df$FutureChoice.Num<-ifelse(df$Future.Choice=="Organize First", 1, 0)

# Assigned Condition (in-lab only)
df$Condition<-factor(recode(as.character(df$Condition), "''=NA; 'Categorize then search'='Organize First';
                     'Search without categorizing'='Search Only'"))
df$Condition<-factor(df$Condition, levels(df$Condition)[c(2,1)])

# Recoding other variables
df$PreTimeDiff<-as.numeric(df$Time_SearchTotal-df$Time_OrgTotal)
df$PostTimeDiff<-as.numeric(df$PostTime_SearchTotal-df$PostTime_OrgTotal)
df$EffDiff<-as.numeric(df$Search.Eff-df$Org.Eff)
df$FunDiff<-as.numeric(df$Search.Fun-df$Org.Fun)
df$Switch.Num<-ifelse(df$Switch=="Same", 0, 1)

# time<-df[complete.cases(df$Time_Org.min), ] # data set where time estimation was measured
# eff<-df[complete.cases(df$Org.Eff), ] # dataset
# fun<-df[complete.cases(df$Org.Fun), ]
# post<-df[!is.na(df$Future.Choice),]
```


**0 = Search without categorizing** 

**1 = Categorize then search**

**NOTE:** Difference scores calculated as the *Search* condition minius *Organization* condition. Positive scores mean that organization is perceived to take less time than search. Proportion scores are calculated as *(Search-Organization)/Organization*

# In-Lab Experiments

```{r}
lab<-subset(df, StudyType=="In Lab")
lab.ex<-subset(lab, Exclusion!="Exclude")
```


# Experiment 1 Only

```{r}
# create data frame to make stack plot

e1<-subset(df, Study=="In Lab E1")
e1.ex<-subset(e1, Exclusion!="Exclude")

```


### Objective Task Time

```{r}
# t-test
t.test(e1.ex$ActualTime_Total~e1.ex$Condition, paired=F)

# sd
sd(e1.ex[e1.ex$Condition=="Organize First",]$ActualTime_Total)
sd(e1.ex[e1.ex$Condition=="Search Only",]$ActualTime_Total)

# cohen's d
effsize::cohen.d(e1.ex$ActualTime_Total~e1.ex$Condition, paired=F, hedges.correction=T)
```


### Choice (Pre & Post-Task)


```{r}
graph2<-ddply(e1, .(), function(df)   
  return(c(dep.avg=mean(df$Choice.Num, na.rm=T), dep.sd=sd(df$Choice.Num, na.rm=T), dep.count=length(df$Choice.Num), 
           dep.sem=(sd(df$Choice.Num))/(sqrt(length(df$Choice.Num))))))

ggplot(graph2, aes(x=.id, y=dep.avg))+ 
  geom_point(size=4, shape=17, position = position_dodge(0.5), 
             colour=wes_palette("IsleofDogs1", n = 1, type="discrete"))+
  geom_errorbar(aes(ymax=dep.avg+dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count), 
                    ymin=dep.avg-dep.sd*qt(0.975,df=dep.count-1)/sqrt(dep.count)),
                width=0, position = position_dodge(0.5),
                colour=wes_palette("IsleofDogs1", n = 1, type="discrete"))+
  theme(
    panel.background= element_rect(fill=NA), # transparent panel
    plot.background = element_rect(fill=NA, colour=NA), #transparent background
    panel.grid=element_blank(), # remove panel grid
    axis.ticks.x=element_blank(), # remove tick marks on x-axis
    axis.ticks=element_line(colour="gray70"), # change colour of tick marks
    panel.border = element_rect(fill="transparent", colour="gray70"), # change panel border colour
    legend.background = element_rect(fill = "transparent", colour = "transparent"), # change legend background
    axis.text = element_text(color="#432620"),
    legend.key = element_rect(fill = "transparent", colour = "transparent")
    # ,legend.position="none"
  )+
  geom_hline(yintercept = .5, linetype="dotted")+
  scale_x_discrete("", label = "Choice")+
  scale_y_continuous("Proportion Choosing 'Organize First'", breaks=seq(-1, 1, 0.1))+
  coord_cartesian(ylim = c(0, 1)) 

```

```{r}
observed = c(39, 14) # observed frequencies
expected = c(0.5, 0.5) # expected proportions

chisq.test(x = observed, p = expected)

```
